# 光伏关断器负载电压电流测试与数据管理系统 产品需求文档 (PRD)

**版本**: V1.0  
**日期**: 2025-01-09  
**作者**: 系统架构师  
**状态**: 待评审  

---

## 1. 项目概述

### 1.1 项目背景
光伏关断器是光伏发电系统中的关键安全设备，需要在各种负载条件下进行严格的电压电流测试。传统测试方式存在自动化程度低、数据管理分散、可视化不足等问题。本系统旨在构建一个现代化、工业级的测试与数据管理平台。

### 1.2 项目目标
- 建立基于 Modbus RTU 协议的本地化实验控制系统
- 实现自动化的单低压高电流测试和双电源切换实验
- 构建完善的实验数据采集、存储、管理体系
- 提供工业级的实时监控和数据可视化界面
- 打造现代化的工业大屏数据总览系统

### 1.3 项目范围
- **包含**: 实验控制、数据采集、数据管理、实时监控、历史分析、权限管理
- **不包含**: 云端部署、移动端应用、第三方系统集成

### 1.4 目标用户
- 主要用户：测试工程师、质量工程师
- 次要用户：生产主管、数据分析师

---

## 2. 功能需求

### 2.1 实验控制界面

#### 2.1.1 Modbus RTU 通信模块
- **功能描述**: 实现与测试设备的双向通信
- **具体要求**:
  - 支持标准 Modbus RTU 协议
  - 可配置串口参数（波特率、数据位、停止位、校验位）
  - 支持读写保持寄存器、输入寄存器
  - 实时通信状态监控
  - 通信异常自动重连机制

#### 2.1.2 单低压高电流测试模块
- **功能描述**: 执行低电压（1-50V）高电流（最高1000A）负载测试
- **测试参数设置**:
  - 电压设定范围：1-50V，精度0.01V
  - 电流设定范围：0-1000A，精度0.1A
  - 测试时长：可设定（秒/分钟/小时）
  - 采样频率：10Hz/100Hz/1000Hz可选
- **测试流程控制**:
  - 一键启动/停止测试
  - 紧急停止功能
  - 测试进度实时显示
  - 异常自动停止保护

#### 2.1.3 双电源切换实验模块
- **功能描述**: 实现主备电源自动切换测试
- **切换参数设置**:
  - 切换条件阈值设定
  - 切换延时设定（ms级精度）
  - 切换次数设定
  - 切换间隔时间
- **切换过程监控**:
  - 切换时序图显示
  - 切换瞬态参数捕获
  - 切换成功率统计

### 2.2 实验数据管理系统

#### 2.2.1 数据采集存储
- **采集内容**:
  - 电压值（V）
  - 电流值（A）
  - 功率值（W）
  - 功率因数
  - 温度数据
  - 设备状态
  - 时间戳（ms级精度）
- **存储架构**:
  - 本地数据库存储（SQLite/PostgreSQL）
  - 数据压缩存储
  - 定期数据归档
  - 存储容量监控预警

#### 2.2.2 数据查询检索
- **查询条件**:
  - 时间范围查询
  - 测试类型筛选
  - 参数范围筛选
  - 设备编号查询
  - 批次号查询
- **查询性能**:
  - 百万级数据秒级响应
  - 支持复合条件查询
  - 查询结果分页显示

#### 2.2.3 数据导出功能
- **导出格式**:
  - Excel格式（.xlsx）
  - CSV格式
  - PDF报告格式
  - JSON数据格式
- **导出内容定制**:
  - 自定义导出字段
  - 自定义时间范围
  - 批量导出支持

#### 2.2.4 权限管理系统
- **用户角色**:
  - 管理员：全部权限
  - 工程师：测试执行、数据查看
  - 查看者：仅数据查看
- **权限控制**:
  - 基于角色的访问控制（RBAC）
  - 操作日志记录
  - 登录认证（本地用户体系）

### 2.3 曲线展示系统

#### 2.3.1 实时曲线展示
- **展示内容**:
  - 电压-时间曲线
  - 电流-时间曲线
  - 功率-时间曲线
  - 多参数叠加显示
- **交互功能**:
  - 实时数据刷新（最快10ms）
  - 曲线缩放、平移
  - 数据点悬停显示
  - 异常点标注

#### 2.3.2 历史数据回放
- **回放功能**:
  - 任意时间段回放
  - 变速回放（0.1x-10x）
  - 暂停/继续功能
  - 关键时刻标记
- **对比分析**:
  - 多组数据对比
  - 差异分析
  - 趋势分析

### 2.4 数据总览大屏系统

#### 2.4.1 总体概览
- **关键指标展示**:
  - 今日测试总数
  - 合格率统计
  - 设备运行状态
  - 异常告警数量
- **实时监控**:
  - 当前测试进度
  - 实时参数显示
  - 设备状态监控

#### 2.4.2 多维度统计
- **时间维度**:
  - 日/周/月/年统计
  - 同比/环比分析
- **设备维度**:
  - 设备使用率
  - 故障率统计
- **产品维度**:
  - 型号合格率
  - 批次质量分析

#### 2.4.3 可视化组件
- **图表类型**:
  - 仪表盘（电压、电流、功率）
  - 折线图（趋势分析）
  - 柱状图（对比分析）
  - 饼图（占比分析）
  - 热力图（分布分析）
- **大屏适配**:
  - 4K分辨率支持
  - 自适应布局
  - 全屏模式

---

## 3. 非功能性需求

### 3.1 性能需求
- 系统响应时间：< 100ms
- 数据采样率：最高1000Hz
- 并发用户数：支持10个
- 数据存储：支持1亿条记录

### 3.2 可靠性需求
- 系统可用性：99.9%
- 数据完整性：100%
- 故障恢复时间：< 5分钟

### 3.3 安全性需求
- 用户认证加密
- 数据传输加密
- 操作审计日志
- 定期数据备份

### 3.4 易用性需求
- 直观的操作界面
- 完善的操作提示
- 详细的帮助文档
- 快捷键支持

### 3.5 可维护性需求
- 模块化设计
- 统一的代码规范
- 完善的日志系统
- 便捷的配置管理

---

## 4. UI/UX 设计规范

### 4.1 设计理念
- **工业美学**: 简洁、精准、专业
- **高端质感**: 深色主题、金属质感、科技感
- **现代风格**: 扁平化设计、渐变色彩、动态效果

### 4.2 色彩规范
- **主色调**: 
  - 深蓝色 (#1B263B)
  - 科技蓝 (#0D9488)
- **辅助色**:
  - 警告色：橙色 (#F59E0B)
  - 错误色：红色 (#EF4444)
  - 成功色：绿色 (#10B981)
- **中性色**:
  - 背景色：深灰 (#111827)
  - 卡片色：中灰 (#1F2937)
  - 文字色：浅灰 (#F3F4F6)

### 4.3 字体规范
- **主字体**: Inter, -apple-system, BlinkMacSystemFont
- **等宽字体**: JetBrains Mono (数据显示)
- **字号规范**:
  - 大标题：32px
  - 标题：24px
  - 正文：16px
  - 辅助文字：14px

### 4.4 组件规范
- **按钮**: 圆角矩形、悬停效果、点击反馈
- **输入框**: 边框发光效果、焦点状态明显
- **卡片**: 微阴影、圆角、悬停上浮效果
- **图表**: 暗色背景、渐变填充、平滑动画

### 4.5 动效规范
- **过渡动画**: 300ms ease-in-out
- **加载动画**: 脉冲效果
- **数据更新**: 渐变过渡
- **交互反馈**: 即时响应

---

## 5. 系统架构

### 5.1 技术架构
```
┌─────────────────────────────────────────────────┐
│                   前端展示层                     │
│         Next.js + TailwindCSS + Chart.js        │
└─────────────────────────────────────────────────┘
                         │
┌─────────────────────────────────────────────────┐
│                   API服务层                      │
│              Node.js + Express                   │
└─────────────────────────────────────────────────┘
                         │
┌─────────────────────────────────────────────────┐
│                   业务逻辑层                     │
│     Modbus通信 | 数据处理 | 权限管理            │
└─────────────────────────────────────────────────┘
                         │
┌─────────────────────────────────────────────────┐
│                   数据存储层                     │
│           SQLite / PostgreSQL                    │
└─────────────────────────────────────────────────┘
```

### 5.2 部署架构
- 本地服务器部署
- 前后端分离架构
- 反向代理（Nginx）
- 进程管理（PM2）

### 5.3 数据流架构
```
测试设备 ──Modbus RTU──> 数据采集 ──> 数据处理 ──> 数据存储
                                           │
                                           ↓
用户界面 <──WebSocket──── 实时推送 <──── 数据查询
```

---

## 6. 接口规范

### 6.1 RESTful API 规范
- 基础路径：`/api/v1/`
- 认证方式：JWT Token
- 响应格式：JSON

### 6.2 主要接口列表

#### 6.2.1 实验控制接口
- `POST /api/v1/experiment/start` - 启动实验
- `POST /api/v1/experiment/stop` - 停止实验
- `GET /api/v1/experiment/status` - 获取实验状态
- `POST /api/v1/experiment/config` - 配置实验参数

#### 6.2.2 数据管理接口
- `GET /api/v1/data/query` - 查询历史数据
- `GET /api/v1/data/export` - 导出数据
- `GET /api/v1/data/statistics` - 获取统计数据
- `DELETE /api/v1/data/archive` - 归档旧数据

#### 6.2.3 系统管理接口
- `POST /api/v1/auth/login` - 用户登录
- `POST /api/v1/auth/logout` - 用户登出
- `GET /api/v1/user/profile` - 获取用户信息
- `PUT /api/v1/user/permission` - 更新权限

### 6.3 WebSocket 接口
- `/ws/realtime` - 实时数据推送
- `/ws/status` - 设备状态推送
- `/ws/alert` - 告警信息推送

---

## 7. 数据模型

### 7.1 实验数据表 (experiment_data)
```sql
CREATE TABLE experiment_data (
    id BIGSERIAL PRIMARY KEY,
    experiment_id VARCHAR(50) NOT NULL,
    timestamp TIMESTAMP WITH TIME ZONE NOT NULL,
    voltage DECIMAL(10,3),
    current DECIMAL(10,3),
    power DECIMAL(10,3),
    power_factor DECIMAL(5,3),
    temperature DECIMAL(5,2),
    device_status VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 7.2 实验信息表 (experiments)
```sql
CREATE TABLE experiments (
    id VARCHAR(50) PRIMARY KEY,
    type VARCHAR(20) NOT NULL,
    start_time TIMESTAMP WITH TIME ZONE,
    end_time TIMESTAMP WITH TIME ZONE,
    status VARCHAR(20),
    operator_id INTEGER,
    device_id VARCHAR(50),
    parameters JSONB,
    result VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 7.3 用户表 (users)
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(20) NOT NULL,
    full_name VARCHAR(100),
    email VARCHAR(100),
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 8. 测试需求

### 8.1 功能测试
- 所有功能模块的正常流程测试
- 异常流程测试
- 边界值测试

### 8.2 性能测试
- 负载测试（1000Hz采样率）
- 压力测试（10用户并发）
- 长时间稳定性测试（7x24小时）

### 8.3 兼容性测试
- 浏览器兼容性（Chrome、Firefox、Edge）
- 分辨率适配（1920x1080、2560x1440、3840x2160）

### 8.4 安全测试
- 认证授权测试
- 数据加密测试
- SQL注入防护测试

---

## 9. 项目计划

### 9.1 开发阶段
1. **第一阶段**（2周）：PRD和技术方案确认、环境搭建
2. **第二阶段**（3周）：实验控制模块开发
3. **第三阶段**（3周）：数据管理系统开发
4. **第四阶段**（2周）：曲线展示系统开发
5. **第五阶段**（2周）：大屏系统开发
6. **第六阶段**（2周）：系统集成测试
7. **第七阶段**（1周）：部署上线

### 9.2 里程碑
- M1：完成系统设计和环境搭建
- M2：完成核心功能开发
- M3：完成所有功能开发
- M4：完成测试并上线

---

## 10. 风险管理

### 10.1 技术风险
- **风险**：Modbus通信不稳定
- **应对**：实现重连机制和缓存队列

### 10.2 性能风险
- **风险**：高频采样数据处理延迟
- **应对**：采用流式处理和数据压缩

### 10.3 安全风险
- **风险**：本地部署的安全隐患
- **应对**：加强访问控制和数据加密

---

## 11. 附录

### 11.1 术语表
- **PV**: Photovoltaic（光伏）
- **Modbus RTU**: 一种串行通信协议
- **SCADA**: 数据采集与监控系统
- **JWT**: JSON Web Token

### 11.2 参考资料
- Modbus协议规范文档
- 光伏关断器测试标准
- 工业UI设计指南

---

**文档版本历史**
| 版本 | 日期 | 作者 | 修改内容 |
|------|------|------|----------|
| V1.0 | 2025-01-09 | 系统架构师 | 初始版本 |